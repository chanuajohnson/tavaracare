
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover" />
    <title>Tavara.care</title>
    <meta name="description" content="Trinidad and Tobago based care platform" />
    <meta name="author" content="Lovable" />
    <meta property="og:image" content="/og-image.png" />
    <link rel="icon" href="/favicon-new.ico" type="image/x-icon">
    <script>
      // Create a timing log to track initialization
      window.tavaraInitTiming = {
        start: Date.now(),
        events: []
      };
      
      // Helper to log initialization events
      function logInitEvent(eventName) {
        if (window.tavaraInitTiming) {
          const timestamp = Date.now();
          const elapsed = timestamp - window.tavaraInitTiming.start;
          window.tavaraInitTiming.events.push({ 
            event: eventName, 
            timestamp,
            elapsed: elapsed + 'ms'
          });
          console.log(`[Init Timing] ${eventName}: +${elapsed}ms`);
        }
      }
      
      logInitEvent('HTML parsing started');
      
      // Create a more comprehensive React placeholder to prevent early errors
      window.React = window.React || {
        version: 'placeholder',
        createElement: function() { 
          logInitEvent('React placeholder createElement called');
          return {}; 
        },
        forwardRef: function() { 
          logInitEvent('React placeholder forwardRef called');
          return function() {}; 
        },
        lazy: function() { 
          logInitEvent('React placeholder lazy called');
          return {}; 
        },
        useState: function() { 
          logInitEvent('React placeholder useState called');
          return [null, function() {}]; 
        },
        Suspense: { 
          $$typeof: Symbol.for('react.suspense'),
          render: function() {}
        },
        memo: function(component) {
          logInitEvent('React placeholder memo called');
          return component;
        },
        Fragment: Symbol.for('react.fragment'),
        createContext: function() {
          logInitEvent('React placeholder createContext called');
          return {
            Provider: function() {},
            Consumer: function() {}
          };
        }
      };
      window.reactInitialized = false; // Will be set to true once React is fully loaded
      
      logInitEvent('React placeholder initialized');
      
      // Display a loading state while the app initializes
      document.addEventListener('DOMContentLoaded', function() {
        logInitEvent('DOMContentLoaded fired');
        
        var rootEl = document.getElementById('root');
        if (rootEl && !window.reactInitialized) {
          rootEl.innerHTML = '<div style="display: flex; justify-content: center; align-items: center; height: 100vh; flex-direction: column;"><img src="/favicon-new.ico" alt="Tavara" style="width: 64px; height: 64px; margin-bottom: 16px;"><p style="margin-bottom: 16px; font-family: system-ui, sans-serif; color: #555">Loading Tavara.care application...</p><div style="width: 50px; height: 50px; border: 5px solid #f3f3f3; border-top: 5px solid #3498db; border-radius: 50%; animation: spin 1s linear infinite;"></div></div><style>@keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }</style>';
        }
      });
      
      // Add a global error handler for initialization issues
      window.onerror = function(message, source, lineno, colno, error) {
        logInitEvent('Error handler triggered: ' + message);
        
        if ((message && message.includes('forwardRef')) || 
            (message && message.includes('createElement')) || 
            (message && message.includes('React'))) {
            
          console.error('[index.html] React initialization error detected:', message);
          console.error('[index.html] Error source:', source);
          console.error('[index.html] React available?', !!window.React);
          console.error('[index.html] React initialized?', !!window.reactInitialized);
          console.error('[index.html] Init timing:', JSON.stringify(window.tavaraInitTiming));
          
          // Capture error details for diagnostics
          window._initLogs = window._initLogs || [];
          window._initLogs.push({
            timestamp: new Date().toISOString(),
            error: message,
            source: source,
            line: lineno,
            col: colno,
            errorMessage: error ? error.message : message,
            errorStack: error ? error.stack : null
          });
          
          // Display fallback UI when React fails to initialize properly
          document.addEventListener('DOMContentLoaded', function() {
            var rootEl = document.getElementById('root');
            if (rootEl) {
              if (rootEl.children.length === 0 || !window.reactInitialized) {
                rootEl.innerHTML = '<div style="padding: 20px; color: #721c24; background-color: #f8d7da; border: 1px solid #f5c6cb; border-radius: 4px; text-align: center;"><h3>Application is initializing...</h3><p>Please wait a moment while we complete the setup.</p><div style="margin: 20px auto; width: 50px; height: 50px; border: 5px solid #f3f3f3; border-top: 5px solid #721c24; border-radius: 50%; animation: spin 1s linear infinite;"></div><p><small>If this message persists, please try refreshing the page.</small></p><button onclick="window.location.reload()" style="background: #721c24; color: white; border: none; padding: 8px 16px; border-radius: 4px; margin-top: 10px; cursor: pointer;">Refresh Page</button><style>@keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }</style></div>';
              }
            }
          });
          
          // Wait for React to be properly loaded before continuing
          setTimeout(function checkAndRecoverReact() {
            if (window.React && window.React.forwardRef && typeof window.React.forwardRef === 'function') {
              logInitEvent('React recovered after error');
              window.reactInitialized = true;
              window.dispatchEvent(new Event('ReactInitialized'));
            } else {
              logInitEvent('Waiting for React recovery...');
              setTimeout(checkAndRecoverReact, 200);
            }
          }, 200);
          
          return true; // Prevents default error handling
        }
        return false; // Allow default error handling for other errors
      };
      
      logInitEvent('HTML head scripts completed');
    </script>
    
    <!-- Enhanced preloading for critical resources -->
     <!--<link rel="preload" href="/node_modules/react/umd/react.production.min.js" as="script" fetchpriority="high" crossorigin="anonymous">-->
     <!--<link rel="preload" href="/node_modules/react-dom/umd/react-dom.production.min.js" as="script" fetchpriority="high" crossorigin="anonymous">-->
    
    <!-- Load React synchronously first to ensure it's ready before any components are rendered -->
   <!--  <script src="/node_modules/react/umd/react.production.min.js" crossorigin="anonymous"></script>-->
    <!--  <script>-->
     <!--   // Mark React as available immediately after loading-->
     <!--   if (window.React && typeof window.React.forwardRef === 'function') {-->
      <!--    window.reactInitialized = true;-->
       <!--   logInitEvent('React loaded from synchronous script');-->
        <!--  // Dispatch event so other components know React is ready-->
        <!--  if (typeof window.dispatchEvent === 'function') {-->
         <!--   window.dispatchEvent(new Event('ReactInitialized'));-->
       <!--   }-->
      <!--  } else {-->
      <!--    console.error('[index.html] React script loaded but React not properly initialized');-->
      <!--  }-->
    <!--  </script>-->
  </head>

  <body>
    <div id="root">
      <!-- Initial loading state -->
      <div style="display: flex; justify-content: center; align-items: center; height: 100vh; flex-direction: column;">
        <img src="/favicon-new.ico" alt="Tavara" style="width: 64px; height: 64px; margin-bottom: 16px;">
        <p style="margin-bottom: 16px; font-family: system-ui, sans-serif; color: #555">Loading Tavara.care application...</p>
        <div style="width: 50px; height: 50px; border: 5px solid #f3f3f3; border-top: 5px solid #3498db; border-radius: 50%; animation: spin 1s linear infinite;"></div>
      </div>
      <style>
        @keyframes spin {
          0% { transform: rotate(0deg); }
          100% { transform: rotate(360deg); }
        }
      </style>
    </div>
    <!-- Main application loading first with highest priority -->
    <script type="module" src="./src/main.tsx"></script>
    <!-- GPT Engineer script - for the Select feature -->
    <script type="module" src="https://cdn.gpteng.co/gptengineer.js"></script>
    <script>
      // Log that the body scripts were parsed
      if (window.logInitEvent) {
        window.logInitEvent('Body scripts parsed');
      }
      
      // Add a timer to check React initialization status
      setTimeout(function() {
        if (window.logInitEvent) {
          window.logInitEvent('Checking React status after scripts');
        }
        console.log('React initialized status after scripts:', !!window.reactInitialized);
        console.log('React forwardRef type:', typeof window.React?.forwardRef);
        
        // Try to initialize React if it seems to be available but not marked as initialized
        if (window.React && typeof window.React.forwardRef === 'function' && !window.reactInitialized) {
          console.log('React appears to be loaded but not marked as initialized, fixing...');
          window.reactInitialized = true;
          window.dispatchEvent(new Event('ReactInitialized'));
        }
      }, 1000);
    </script>
  </body>
</html>
